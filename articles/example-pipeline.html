<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example pipeline • BREADR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example pipeline">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BREADR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example-pipeline.html">Example pipeline</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/jonotuke/BREADR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example pipeline</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jonotuke/BREADR/blob/master/vignettes/example-pipeline.Rmd" class="external-link"><code>vignettes/example-pipeline.Rmd</code></a></small>
      <div class="d-none name"><code>example-pipeline.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonotuke/BREADR" class="external-link">BREADR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>This basic example shows you how to analyse a real (anonymised)
ancient DNA data set.</p>
<p>An analysis would normally start by defining paths to all three
Eigenstrat files, i.e.,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ind_path</span> <span class="op">&lt;-</span> <span class="st">"path/to/eigenstrat/indfile"</span></span>
<span><span class="va">snp_path</span> <span class="op">&lt;-</span> <span class="st">"path/to/eigenstrat/snpfile"</span></span>
<span><span class="va">geno_path</span> <span class="op">&lt;-</span> <span class="st">"path/to/eigenstrat/genofile"</span></span></code></pre></div>
<p>and we would then preprocess this data using the processEigenstrat()
function,</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/processEigenstrat.html">processEigenstrat</a></span><span class="op">(</span></span>
<span>  indfile <span class="op">=</span> <span class="va">ind_path</span>,</span>
<span>  snpfile <span class="op">=</span> <span class="va">snp_path</span>,</span>
<span>  genofile <span class="op">=</span> <span class="va">geno_path</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Since this step is the most computationally expensive, we include an
option to automatically save the output as a TSV upon completion of the
preprocessing, i.e, to avoid repeating the preprocessing</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">counts_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/processEigenstrat.html">processEigenstrat</a></span><span class="op">(</span></span>
<span>  indfile <span class="op">=</span> <span class="va">ind_path</span>,</span>
<span>  snpfile <span class="op">=</span> <span class="va">snp_path</span>,</span>
<span>  genofile <span class="op">=</span> <span class="va">geno_path</span>,</span>
<span>  outfile <span class="op">=</span> <span class="st">"path_to_save_tsv"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Also included are options to change the minimum distance between
overlapping sites (filter_length) from the default
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>×</mo><msup><mn>10</mn><mn>5</mn></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">1\times 10^5,</annotation></semantics></math>
an option to only include individuals (pop_pattern) from certain
populations (as defined in the ind file) and an option to remove C-&gt;T
and G-&gt;A SNPs to avoid the effects of deamination.</p>
<p>Note that since the Eigenstrat files are too large to include, we
provide a pre-processed data set called <a href="https://github.com/jonotuke/BREADR/blob/master/data/counts_example.rda" class="external-link">counts_example</a>
which is the product of running processEigenstrat() on real data
(although the raw Eigenstrat files can be found on <a href="https://github.com/jonotuke/BREADR/tree/master/data-raw" class="external-link">the
Github page</a>).</p>
<p>We now load the counts_example tibble.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jonotuke/BREADR" class="external-link">BREADR</a></span><span class="op">)</span></span>
<span><span class="va">counts_example</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;           pair nsnps mismatch       pmr</span></span>
<span><span class="co">#&gt; 1  Ind1 - Ind2  1518      310 0.2042161</span></span>
<span><span class="co">#&gt; 2  Ind1 - Ind3  9435     2093 0.2218336</span></span>
<span><span class="co">#&gt; 3  Ind1 - Ind4  8283     1854 0.2238319</span></span>
<span><span class="co">#&gt; 4  Ind1 - Ind5  1336      314 0.2350299</span></span>
<span><span class="co">#&gt; 5  Ind1 - Ind6  2242      481 0.2145406</span></span>
<span><span class="co">#&gt; 6  Ind2 - Ind3  9119     1988 0.2180064</span></span>
<span><span class="co">#&gt; 7  Ind2 - Ind4  7984     1699 0.2128006</span></span>
<span><span class="co">#&gt; 8  Ind2 - Ind5  1179      270 0.2290076</span></span>
<span><span class="co">#&gt; 9  Ind2 - Ind6  1965      423 0.2152672</span></span>
<span><span class="co">#&gt; 10 Ind3 - Ind4 20952     2253 0.1075315</span></span>
<span><span class="co">#&gt; 11 Ind3 - Ind5  7994     1703 0.2130348</span></span>
<span><span class="co">#&gt; 12 Ind3 - Ind6 10994     2398 0.2181190</span></span>
<span><span class="co">#&gt; 13 Ind4 - Ind5  6924     1451 0.2095609</span></span>
<span><span class="co">#&gt; 14 Ind4 - Ind6  9745     2141 0.2197024</span></span>
<span><span class="co">#&gt; 15 Ind5 - Ind6  1739      383 0.2202415</span></span></code></pre>
<p>We can we can estimate the degrees of relatedness from the raw counts
using the callRelatedness() function. Users have the option to change
the prior probability for each degree of relatedness (class_prior) from
the default uniform prior, to define the expected PMR
(average_relatedness) for a pair of unrelated individuals from the
default of the sample median, and to set the minimum number of
overlapping SNPs required for a pair of individuals (filter_n) to be
included in the analysis from the default of 1. If the user decides to
use the sample median as an estimate for the expected PMR for a pair of
unrelated individuals, the minimum number of overlapping SNPs for a pair
(median_co) can be changed from the default of 500.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">relatedness_example</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/callRelatedness.html">callRelatedness</a></span><span class="op">(</span><span class="va">counts_example</span><span class="op">)</span></span>
<span><span class="va">relatedness_example</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 15 × 12</span></span></span>
<span><span class="co">#&gt;      row pair       relationship   pmr      sd mismatch nsnps ave_rel Same_Twins</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Ind1 - In… Unrelated    0.204 0.010<span style="text-decoration: underline;">3</span>       310  <span style="text-decoration: underline;">1</span>518   0.218  6.71<span style="color: #949494;">e</span><span style="color: #BB0000;">- 26</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Ind1 - In… Unrelated    0.222 0.004<span style="text-decoration: underline;">28</span>     <span style="text-decoration: underline;">2</span>093  <span style="text-decoration: underline;">9</span>435   0.218  1.22<span style="color: #949494;">e</span><span style="color: #BB0000;">-214</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 Ind1 - In… Unrelated    0.224 0.004<span style="text-decoration: underline;">58</span>     <span style="text-decoration: underline;">1</span>854  <span style="text-decoration: underline;">8</span>283   0.218  2.00<span style="color: #949494;">e</span><span style="color: #BB0000;">-194</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 Ind1 - In… Unrelated    0.235 0.011<span style="text-decoration: underline;">6</span>       314  <span style="text-decoration: underline;">1</span>336   0.218  2.68<span style="color: #949494;">e</span><span style="color: #BB0000;">- 37</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 Ind1 - In… Unrelated    0.215 0.008<span style="text-decoration: underline;">67</span>      481  <span style="text-decoration: underline;">2</span>242   0.218  9.82<span style="color: #949494;">e</span><span style="color: #BB0000;">- 46</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 Ind2 - In… Unrelated    0.218 0.004<span style="text-decoration: underline;">32</span>     <span style="text-decoration: underline;">1</span>988  <span style="text-decoration: underline;">9</span>119   0.218  5.06<span style="color: #949494;">e</span><span style="color: #BB0000;">-195</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 Ind2 - In… Unrelated    0.213 0.004<span style="text-decoration: underline;">58</span>     <span style="text-decoration: underline;">1</span>699  <span style="text-decoration: underline;">7</span>984   0.218  4.95<span style="color: #949494;">e</span><span style="color: #BB0000;">-156</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 Ind2 - In… Unrelated    0.229 0.012<span style="text-decoration: underline;">2</span>       270  <span style="text-decoration: underline;">1</span>179   0.218  1.80<span style="color: #949494;">e</span><span style="color: #BB0000;">- 30</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 Ind2 - In… Unrelated    0.215 0.009<span style="text-decoration: underline;">27</span>      423  <span style="text-decoration: underline;">1</span>965   0.218  1.10<span style="color: #949494;">e</span><span style="color: #BB0000;">- 40</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 Ind3 - In… Same_Twins   0.108 0.002<span style="text-decoration: underline;">14</span>     <span style="text-decoration: underline;">2</span>253 <span style="text-decoration: underline;">20</span>952   0.218  1   <span style="color: #949494;">e</span>+  0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 Ind3 - In… Unrelated    0.213 0.004<span style="text-decoration: underline;">58</span>     <span style="text-decoration: underline;">1</span>703  <span style="text-decoration: underline;">7</span>994   0.218  6.83<span style="color: #949494;">e</span><span style="color: #BB0000;">-157</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    12 Ind3 - In… Unrelated    0.218 0.003<span style="text-decoration: underline;">94</span>     <span style="text-decoration: underline;">2</span>398 <span style="text-decoration: underline;">10</span>994   0.218  2.05<span style="color: #949494;">e</span><span style="color: #BB0000;">-235</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>    13 Ind4 - In… Unrelated    0.210 0.004<span style="text-decoration: underline;">89</span>     <span style="text-decoration: underline;">1</span>451  <span style="text-decoration: underline;">6</span>924   0.218  1.92<span style="color: #949494;">e</span><span style="color: #BB0000;">-127</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>    14 Ind4 - In… Unrelated    0.220 0.004<span style="text-decoration: underline;">19</span>     <span style="text-decoration: underline;">2</span>141  <span style="text-decoration: underline;">9</span>745   0.218  2.95<span style="color: #949494;">e</span><span style="color: #BB0000;">-214</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>    15 Ind5 - In… Unrelated    0.220 0.009<span style="text-decoration: underline;">94</span>      383  <span style="text-decoration: underline;">1</span>739   0.218  3.64<span style="color: #949494;">e</span><span style="color: #BB0000;">- 39</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 3 more variables: First_Degree &lt;dbl&gt;, Second_Degree &lt;dbl&gt;, Unrelated &lt;dbl&gt;</span></span></span></code></pre>
<p>An overall picture of the relatedness for these individuals can be
created, which displays the highest posterior probability degree of
relatedness for each pair of individuals, indicated by the colour and
shape of the points with 95% confidence intervals. The dashed horizontal
lines indicated the expected values for each degree of relatedness.</p>
<p>Users can choose to remove individuals with less than a user-defined
number of overlapping SNPs (nsnps_cutoff). In large data sets, it is
expected that the vast majority of individuals will be unrelated, and so
the user may wish to only plot the more closely related individuals. TO
this end, the user may choose to plot only the first
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
individuals (using the input parameter N), which have been sorted by PMR
value, in ascending order.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotLOAF.html">plotLOAF</a></span><span class="op">(</span><span class="va">relatedness_example</span><span class="op">)</span></span>
<span><span class="co">#&gt; No minimum number of overlapping SNPs given.</span></span>
<span><span class="co">#&gt; Using default minimum of 500.</span></span>
<span><span class="co">#&gt; No upper limit on number of pairs to plot given.</span></span>
<span><span class="co">#&gt; Plotting first 15 pairs.</span></span></code></pre></div>
<p><img src="example-pipeline_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>A plot for the assignment of the “Unrelated” degree of relatedness to
individuals Ind1 and Ind2 can be produced which shows diagnostic
information about the estimated genetic relatedness between a single
pair of individuals. In the left panel, the distribution of PMR values
for each degree of relatedness, given the number of overlapping SNPs,
with the observed PMR (and 95% confidence interval) displayed below
this. In the right panel are the normalised posterior probabilities for
the each of the degrees of relatedness, indicating the certainty with
which the degree of relatedness with the highest posterior probability
was chosen.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSLICE.html">plotSLICE</a></span><span class="op">(</span><span class="va">relatedness_example</span>, row <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-pipeline_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Alternatively we can choose the row using the full pair name instead
of the row number.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSLICE.html">plotSLICE</a></span><span class="op">(</span><span class="va">relatedness_example</span>, row <span class="op">=</span> <span class="st">"Ind1 - Ind2"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-pipeline_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>We can test whether the observed PMR between Ind1 and Ind2 is
consistent with a 3rd-degree genetic relationship, or not, but any
degree of relatedness from 0 to 10 can be investigated. This function
returns the p-value from the associated binomial test, and by setting
verbose to TRUE, all diagnostic output from the test can be
displayed</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/test_degree.html">test_degree</a></span><span class="op">(</span><span class="va">relatedness_example</span>, <span class="fl">1</span>, <span class="fl">3</span>, verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Testing H0       : "Ind1 - Ind2" are 3rd-degree relatives.</span></span>
<span><span class="co">#&gt; Expected PMR     : 0.2044</span></span>
<span><span class="co">#&gt; Observed PMR     : 0.2042</span></span>
<span><span class="co">#&gt; Estimated degree : 2.9826</span></span>
<span><span class="co">#&gt; p-value          : 0.9823</span></span>
<span><span class="co">#&gt; Decision         : Retain H0</span></span>
<span><span class="co">#&gt; [1] 0.9823165</span></span></code></pre></div>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jono Tuke, Adam B. Rohrlach, Wolfgang Haak, Divyaratan Popli.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
